jQuery(document).ready((function(){if(jQuery(".zp-Zotpress-Bib").length>0){var e={},t=0;jQuery(".zp-Zotpress-Bib").each((function(t,n){var i=jQuery(n),p={zpItemkey:!1};jQuery(".ZP_ITEM_KEY",i).text().trim().length>0&&(p.zpItemkey=jQuery(".ZP_ITEM_KEY",i).text()),p.zpItemType=!1,jQuery(".ZP_ITEMTYPE",i).text().trim().length>0&&(p.zpItemType=jQuery(".ZP_ITEMTYPE",i).text()),p.zpCollectionId=!1,jQuery(".ZP_COLLECTION_ID",i).text().trim().length>0&&(p.zpCollectionId=jQuery(".ZP_COLLECTION_ID",i).text()),p.zpTagId=!1,jQuery(".ZP_TAG_ID",i).text().trim().length>0&&(p.zpTagId=jQuery(".ZP_TAG_ID",i).text()),p.zpAuthor=!1,jQuery(".ZP_AUTHOR",i).text().trim().length>0&&(p.zpAuthor=jQuery(".ZP_AUTHOR",i).text()),p.zpYear=!1,jQuery(".ZP_YEAR",i).text().trim().length>0&&(p.zpYear=jQuery(".ZP_YEAR",i).text()),p.zpStyle=!1,jQuery(".ZP_STYLE",i).text().trim().length>0&&(p.zpStyle=jQuery(".ZP_STYLE",i).text()),p.zpLimit=!1,jQuery(".ZP_LIMIT",i).text().trim().length>0&&(p.zpLimit=jQuery(".ZP_LIMIT",i).text()),p.zpTitle=!1,jQuery(".ZP_TITLE",i).text().trim().length>0&&(p.zpTitle=jQuery(".ZP_TITLE",i).text()),p.zpShowImages=!1,jQuery(".ZP_SHOWIMAGE",i).text().trim().length>0&&(p.zpShowImages=jQuery(".ZP_SHOWIMAGE",i).text().trim()),p.zpShowTags=!1,jQuery(".ZP_SHOWTAGS",i).text().trim().length>0&&(p.zpShowTags=!0),p.zpDownloadable=!1,jQuery(".ZP_DOWNLOADABLE",i).text().trim().length>0&&(p.zpDownloadable=!0),p.zpInclusive=!1,jQuery(".ZP_INCLUSIVE",i).text().trim().length>0&&(p.zpInclusive=!0),p.zpShowNotes=!1,jQuery(".ZP_NOTES",i).text().trim().length>0&&(p.zpShowNotes=!0),p.zpShowAbstracts=!1,jQuery(".ZP_ABSTRACT",i).text().trim().length>0&&(p.zpShowAbstracts=!0),p.zpCiteable=!1,jQuery(".ZP_CITEABLE",i).text().trim().length>0&&(p.zpCiteable=!0),p.zpTarget=!1,jQuery(".ZP_TARGET",i).text().trim().length>0&&(p.zpTarget=!0),p.zpURLWrap=!1,jQuery(".ZP_URLWRAP",i).text().trim().length>0&&(p.zpURLWrap=jQuery(".ZP_URLWRAP",i).text()),p.zpHighlight=!1,jQuery(".ZP_HIGHLIGHT",i).text().trim().length>0&&(p.zpHighlight=jQuery(".ZP_HIGHLIGHT",i).text()),p.zpUpdateNeeded=!1,jQuery(".ZP_UPDATENEEDED",i).text().trim().length>0&&"true"==jQuery(".ZP_UPDATENEEDED",i).text()&&(p.zpUpdateNeeded=!0),p.zpJSON=!1,jQuery(".ZP_JSON",i).text().trim().length>0&&(p.zpJSON=jQuery(".ZP_JSON",i).text().trim()),p.zpForceNumsCount=1,p.zpBibIndex=t,$fromScratch=!0,!jQuery(".ZP_JSON",i).text().trim().length>0&&($fromScratch=!1);var s=JSON.parse(decodeURIComponent(p.zpJSON));if(r(i,s,p),console.log("---"),p.zpCollectionId&&-1!=p.zpCollectionId.indexOf(","))e[t]=p.zpCollectionId.split(","),p.zpCollectionId=e[t][0],a(0,0,i,p,$fromScratch);else if(p.zpTagId&&1==p.zpInclusive&&-1!=p.zpTagId.indexOf(",")){var o=p.zpTagId.split(",");jQuery.each(o,(function(e,t){p.zpTagId=t,a(0,0,i,p,$fromScratch)}))}else if(p.zpAuthor&&-1!=p.zpAuthor.indexOf(",")){var l=p.zpAuthor.split(",");1==p.zpInclusive?jQuery.each(l,(function(e,t){p.zpAuthor=t,a(0,0,i,p,$fromScratch)})):a(0,0,i,p,$fromScratch)}else if(p.zpYear&&-1!=p.zpYear.indexOf(",")){var c=p.zpYear.split(",");jQuery.each(c,(function(e,t){p.zpYear=t,a(0,0,i,p,$fromScratch)}))}else a(0,0,i,p,$fromScratch)}))}function a(n,i,p,s,o){console.log("zp: calling zp_get_items with update check?",o),console.log("zp: is an update needed?",s.zpUpdateNeeded),void 0!==n&&"false"!=n&&""!=n||(n=0),void 0!==i&&"false"!=i&&""!=i||(i=0),jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",instance_id:p.attr("id"),api_user_id:jQuery(".ZP_API_USER_ID",p).text(),item_type:jQuery(".ZP_ITEM_TYPE",p).text(),item_key:s.zpItemkey,itemtype:s.zpItemType,collection_id:s.zpCollectionId,tag_id:s.zpTagId,author:encodeURI(s.zpAuthor).replace("'","%27"),year:s.zpYear,style:s.zpStyle,limit:s.zpLimit,title:s.zpTitle,showimage:s.zpShowImages,showtags:s.zpShowTags,downloadable:s.zpDownloadable,inclusive:s.zpInclusive,shownotes:s.zpShowNotes,showabstracts:s.zpShowAbstracts,citeable:s.zpCiteable,target:s.zpTarget,urlwrap:s.zpURLWrap,highlight:s.zpHighlight,sortby:jQuery(".ZP_SORTBY",p).text(),order:jQuery(".ZP_ORDER",p).text(),update:o,request_update:s.zpUpdateNeeded,request_start:n,request_last:i,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(n){var i=jQuery.parseJSON(n);if(t+=i.data.length,o?console.log("zp: running update for items:",t,"->",i.data.length):console.log("zp: adding items:",t,"->",i.data.length),"empty"==i.status||"Not found"==i.data){var l=zpShortcodeAJAX.txt_zperror+" ";0==i.data?(i.data=zpShortcodeAJAX.txt_noitemsfound,l=i.data):l+=i.data,console.log("Zotpress: "+l);var c="";jQuery("#"+i.instance+" .zp-List .zp-Entry").length>0&&(c=' class="hide"'),jQuery("#"+i.instance+" .zp-List").removeClass("loading").append("<p"+c+">"+l+"</p>")}else if(jQuery("#"+i.instance+" .zp-SEO-Content").remove(),void 0!==i&&null!=i&&0!=i&&i.data.length>0){var u="";if(1==s.zpShowNotes)var d="";!1===o?jQuery("#"+i.instance+" .zp-List").addClass("used_cache"):!0===o&&(!jQuery("#"+i.instance+" .zp-List").hasClass("updating")&&jQuery("#"+i.instance+" .zp-Citation-Notes").length>0&&jQuery("#"+i.instance+" .zp-Citation-Notes").remove(),jQuery("#"+i.instance+" .zp-List").hasClass("updating")||jQuery("#"+i.instance+" .zp-List").addClass("updating"),s.zpForceNumsCount=1),0!=i.data&&jQuery.each(i.data,(function(e,t){var a="",r=jQuery("#"+i.instance+" .zp-List #zp-ID-"+jQuery(".ZP_POSTID",p).text()+"-"+jQuery(".ZP_API_USER_ID",p).text()+"-"+t.key);if(r.length>0&&!1===o&&!jQuery("#"+i.instance+" .zp-List").hasClass("used_cache"))return!1;var n="none";t.data.hasOwnProperty("itemType")&&(n=t.data.itemType);var l="0000",c="0000";t.meta.hasOwnProperty("parsedDate")&&(l=t.meta.parsedDate.substring(0,4),c=t.meta.parsedDate);var z=t.data.title;t.meta.hasOwnProperty("creatorSummary")&&(z=t.meta.creatorSummary.replace(/ /g,"-")),a+="<div id='zp-ID-"+jQuery(".ZP_POSTID",p).text()+"-"+jQuery(".ZP_API_USER_ID",p).text()+"-"+t.key+"'",a+=" data-zp-author-date='"+z+"-"+c+"'",a+=" data-zp-date-author='"+c+"-"+z+"'",a+=" data-zp-date='"+c+"'",a+=" data-zp-year='"+l+"'",a+=" data-zp-itemtype='"+n+"'",a+=" class='zp-Entry zpSearchResultsItem",!0===o&&(a+=" zp_updated"),jQuery("#"+i.instance+" .ZP_SHOWIMAGE").text().trim().length>0&&t.hasOwnProperty("image")?(a+=" zp-HasImage'>\n",a+="<div id='zp-Citation-"+t.key+"' class='zp-Entry-Image hasImage' rel='"+t.key+"'>\n","image"==s.zpURLWrap&&""!=t.data.url&&(a+="<a href='"+t.data.url+"'",s.zpTarget&&(a+=" target='_blank'"),a+=">"),a+="<img class='thumb' src='"+t.image[0]+"' alt='image' />\n","image"==s.zpURLWrap&&""!=t.data.url&&(a+="</a>"),a+="</div>\n"):a+="'>\n",jQuery("#"+i.instance+" .ZP_FORCENUM").text().length>0&&"1"==jQuery("#"+i.instance+" .ZP_FORCENUM").text()&&(/csl-left-margin/i.test(t.bib)||(t.bib=t.bib.replace('<div class="csl-entry">','<div class="csl-entry">'+s.zpForceNumsCount+". "),s.zpForceNumsCount++)),a+=t.bib,1==s.zpShowAbstracts&&t.data.hasOwnProperty("abstractNote")&&t.data.abstractNote.length>0&&(a+="<p class='zp-Abstract'><span class='zp-Abstract-Title'>Abstract:</span> "+t.data.abstractNote+"</p>\n"),1==s.zpShowTags&&t.data.hasOwnProperty("tags")&&t.data.tags.length>0&&(a+="<p class='zp-Zotpress-ShowTags'><span class='title'>Tags:</span> ",jQuery.each(t.data.tags,(function(e,r){a+="<span class='tag'>"+r.tag+"</span>",e!=t.data.tags.length-1&&(a+="<span class='separator'>,</span> ")})),a+="</p>\n"),a+="</div>\n",1==s.zpShowNotes&&t.hasOwnProperty("notes")&&(d+=t.notes),r.length>0&&!0===o?r.replaceWith(jQuery(a)):u+=a})),jQuery("#"+i.instance+" .zp-List").append(u),1==s.zpShowNotes&&d.length>0&&(d="<div class='zp-Citation-Notes'>\n<h4>Notes</h4>\n<ol>\n"+d,d+="</ol>\n</div>\x3c!-- .zp-Citation-Notes --\x3e\n\n",jQuery("#"+i.instance).append(d)),jQuery("#"+i.instance+" .zp-List .csl-left-margin").length>0&&jQuery(".ZP_STYLE",p).text().trim().length>0&&"american-antiquity"!=jQuery(".ZP_STYLE",p).text().trim()&&(s.zpForceNumsCount=1,jQuery("#"+i.instance+" .zp-List .csl-left-margin").each((function(e,t){var a=jQuery(t).text();a=a.replace(a.match(/\d+/)[0],s.zpForceNumsCount),jQuery(t).text(a),s.zpForceNumsCount++}))),r(p,i,s),0!=i.meta.request_next&&"false"!=i.meta.request_next?a(i.meta.request_next,i.meta.request_last,p,s,o):(jQuery("#"+i.instance+" .zp-List").removeClass("loading"),i.updateneeded?(console.log("zp: update needed"),s.zpUpdateNeeded=!0,a(0,0,p,s,!0)):e[s.zpBibIndex]&&e[s.zpBibIndex].length>0&&e[s.zpBibIndex][e[s.zpBibIndex].length-1]!=s.zpCollectionId?(s.zpCollectionId=e[s.zpBibIndex][e[s.zpBibIndex].indexOf(s.zpCollectionId)+1],jQuery("#"+i.instance+" .zp-List").removeClass("updating"),a(0,0,p,s,o)):(console.log("zp: done"),console.log("---")))}else console.log("zp: done"),!0===o&&(jQuery("#"+p.attr("id")+" .zp-List").removeClass("loading"),0==jQuery("#"+p.attr("id")+" .zp-List .zp-Entry").length&&jQuery("#"+p.attr("id")+" .zp-List").append("<p>There are no citations to display.</p>\n"))},error:function(e){console.log("Zotpress via WP AJAX Error: ",e)}})}function r(e,t,a){console.log("zp: reformatting");var r=jQuery(".ZP_SORTBY",e).text(),n=jQuery(".ZP_ORDER",e).text(),i="data-zp-author-date";if("date"==r&&(i="data-zp-date-author"),function(e,t,a,r){console.log("zp: running typical sort"),-1!==["author","date"].indexOf(t)&&0==jQuery("#"+e.instance+" .zp-List .csl-left-margin").length&&jQuery("#"+e.instance+" .zp-List div.zp-Entry").sort((function(e,t){var n=e.getAttribute(a).toLowerCase(),i=t.getAttribute(a).toLowerCase();return n>i?"asc"==r?1:-1:n<i?"asc"==r?-1:1:0})).detach().appendTo("#"+e.instance+" .zp-List")}(t,r,i,n),!1!==a.zpTitle){var p={};jQuery("#"+t.instance+" .zp-List div.zp-Entry").each((function(e,t){var r=jQuery(t).data("zp-"+a.zpTitle);!1===p.hasOwnProperty(r)&&(p[r]=[]),p[r].push(jQuery(t).attr("id"))}));var s=Object.getOwnPropertyNames(p);if("itemtype"==a.zpTitle){var o=["book","bookSection","journalArticle","conferencePaper","thesis","report","encyclopediaArticle","newspaperArticle","magazineArticle","presentation","interview","dictionaryEntry","document","manuscript","patent","map","blogPost","webpage","artwork","film","audioRecording","statute","bill","case","hearing","forumPost","letter","email","instantMessage","software","podcast","radioBroadcast","tvBroadcast","videoRecording","attachment","note","preprint"];o.slice(0).forEach((function(e,t){-1==s.indexOf(e)&&o.splice(o.indexOf(e),1)})),s=o}else"asc"==n?s.sort((function(e,t){return e-t})):s.sort((function(e,t){return t-e}));s.forEach((function(t,i){var s=t;if("itemtype"==a.zpTitle){if(null!==s.match(/[A-Z]/)){var o=s.match(/[A-Z]/).index;s=s.substr(0,o)+" "+s.substr(o)}s=s.charAt(0).toUpperCase()+s.slice(1)}"0000"==s&&(s="No date"),a.zpTitle,0==jQuery("#"+e.attr("id")+" .zp-List h3[rel='"+t+"']").length&&jQuery("#"+e.attr("id")+" .zp-List").append("<h3 rel='"+t+"'>"+s+"</h3>\n"),("year"==a.zpTitle&&"asc"==n||"itemtype"==a.zpTitle&&"date"==r)&&p[t].reverse(),p[t].forEach((function(a,r){jQuery("#"+e.attr("id")+" #"+a).insertAfter(jQuery("#"+e.attr("id")+" .zp-List h3[rel='"+t+"']"))}))}))}}}));