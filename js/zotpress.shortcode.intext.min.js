jQuery(document).ready(function(){jQuery(".zp-Zotpress-InTextBib").length>0&&(window.zpIntextCitations={},window.zpIntextCitationCount={},jQuery(".zp-Zotpress-InTextBib").each(function(t,e){var a=jQuery(e),r={};window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",a).text()]={},r.zpItemkey=!1,jQuery(".ZP_ITEM_KEY",a).text().trim().length>0&&(r.zpItemkey=jQuery(".ZP_ITEM_KEY",a).text()),r.zpStyle=!1,jQuery(".ZP_STYLE",a).text().trim().length>0&&(r.zpStyle=jQuery(".ZP_STYLE",a).text()),r.zpTitle=!1,jQuery(".ZP_TITLE",a).text().trim().length>0&&(r.zpTitle=jQuery(".ZP_TITLE",a).text()),r.zpShowImages=!1,jQuery(".ZP_SHOWIMAGE",a).text().trim().length>0&&(r.zpShowImages=jQuery(".ZP_SHOWIMAGE",a).text().trim()),r.zpShowTags=!1,jQuery(".ZP_SHOWTAGS",a).text().trim().length>0&&(r.zpShowTags=!0),r.zpDownloadable=!1,jQuery(".ZP_DOWNLOADABLE",a).text().trim().length>0&&(r.zpDownloadable=!0),r.zpShowNotes=!1,jQuery(".ZP_NOTES",a).text().trim().length>0&&(r.zpShowNotes=!0),r.zpShowAbstracts=!1,jQuery(".ZP_ABSTRACT",a).text().trim().length>0&&(r.zpShowAbstracts=!0),r.zpCiteable=!1,jQuery(".ZP_CITEABLE",a).text().trim().length>0&&(r.zpCiteable=!0),r.zpTarget=!1,jQuery(".ZP_TARGET",a).text().trim().length>0&&(r.zpTarget=!0),r.zpURLWrap=!1,jQuery(".ZP_URLWRAP",a).text().trim().length>0&&(r.zpURLWrap=jQuery(".ZP_URLWRAP",a).text()),r.zpHighlight=!1,jQuery(".ZP_HIGHLIGHT",a).text().trim().length>0&&(r.zpHighlight=jQuery(".ZP_HIGHLIGHT",a).text()),r.zpSortBy=!1,jQuery(".ZP_SORTBY",a).text().trim().length>0&&(r.zpSortBy=jQuery(".ZP_SORTBY",a).text()),r.zpOrder=!1,jQuery(".ZP_ORDER",a).text().trim().length>0&&(r.zpOrder=jQuery(".ZP_ORDER",a).text()),function t(e,a,r,s,p){(void 0===e||"false"==e||""==e)&&(e=0),(void 0===a||"false"==a||""==a)&&(a=0),jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",instance_id:r.attr("id"),type:"intext",item_key:s.zpItemkey,style:s.zpStyle,title:s.zpTitle,showimage:s.zpShowImages,showtags:s.zpShowTags,downloadable:s.zpDownloadable,shownotes:s.zpShowNotes,showabstracts:s.zpShowAbstracts,citeable:s.zpCiteable,target:s.zpTarget,urlwrap:s.zpURLWrap,highlight:s.zpHighlight,sortby:s.zpSortBy,order:s.zpOrder,update:p,request_start:e,request_last:a,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(e){var a=jQuery.parseJSON(e);if("error"==a.status){console.log("Zotpress Error: "+a.data);var n="";jQuery("#"+a.instance+" .zp-List .zp-Entry").length>0&&(n=' class="hide"'),jQuery("#"+a.instance+" .zp-List").removeClass("loading").append("<p"+n+">Zotpress Error: "+a.data+"</p>")}else if(void 0!==a&&null!=a&&0!=parseInt(a)&&a.data.length>0){if(!0==s.zpShowNotes)var i,o,l,d,c,h,z,g,m="";if(s.zpTitle,jQuery(r).parent(),!1===p?jQuery("#"+a.instance+" .zp-List").addClass("used_cache"):!0!==p||(!jQuery("#"+a.instance+" .zp-List").hasClass("updating")&&jQuery("#"+a.instance+" .zp-Citation-Notes").length>0&&jQuery("#"+a.instance+" .zp-Citation-Notes").remove(),jQuery("#"+a.instance+" .zp-List").hasClass("updating")||jQuery("#"+a.instance+" .zp-List").addClass("updating")),i=r,o=s.zpItemkey,l=a.data,d=s,c=p,h=[],-1!=o.indexOf(";")?h=o.split(";"):h.push(o),z={},jQuery.each(l,function(t,e){z.hasOwnProperty(e.key)||(z[e.key]=e)}),l=z,g={},jQuery.each(h,function(t,e){var a="",r=jQuery(i).parent(),s="zp-InText-zp-ID-"+e.replace(/{/g,"-").replace(/}/g,"-").replace(/,/g,"_").replace(/:/g,"-")+"-wp"+jQuery(".ZP_POSTID",i).text(),p=0;jQuery("."+s,r).length>1&&(g.hasOwnProperty(s)?p=g[s]:g[s]=0);var n=JSON.parse(jQuery("."+s+":eq("+p+")",r).attr("rel").replace(/'/g,'"'));intext_citation_split=e.split("},{"),e=[],jQuery.each(intext_citation_split,function(t,a){item_parts=a.split(":"),item_pages=!1,"np"!=n.pages&&("np"==(item_pages=n.pages.split("--"))[t]&&(item_pages[t]=!1),item_pages=item_pages[t]),e[t]={api_user_id:item_parts[0].replace("{",""),key:item_parts[1].replace("}",""),post_id:jQuery(".ZP_POSTID",i).text(),pages:item_pages}});var o=[];jQuery.each(e,function(t,a){var r="",s="",p="";if(window.zpIntextCitations["post-"+a.post_id].hasOwnProperty(a.key)||(window.zpIntextCitations["post-"+a.post_id][a.key]=a,void 0===window.zpIntextCitationCount["post-"+a.post_id]&&(window.zpIntextCitationCount["post-"+a.post_id]=0),window.zpIntextCitationCount["post-"+a.post_id]++,window.zpIntextCitations["post-"+a.post_id][a.key].num=window.zpIntextCitationCount["post-"+a.post_id]),l.hasOwnProperty(a.key)){if(l[a.key].data.hasOwnProperty("creators")){var i=0,d=!1;if(jQuery.each(l[a.key].data.creators,function(t,e){if("author"==e.creatorType)return d=!0,!1}),jQuery.each(l[a.key].data.creators,function(t,e){if(d&&"author"!=e.creatorType)return!0;i++,0!=t&&i>1&&(s+=", "),e.hasOwnProperty("name")?s+=e.name:e.hasOwnProperty("lastName")&&(s+=e.lastName)}),-1==o.indexOf(s)?o[o.length]=s:s="",s=s.split(", "),jQuery.isArray(s)&&s.length>2&&(""==n.etal||"default"==n.etal||"yes"==n.etal&&(s=s[0]+" <em>et al.</em>")),jQuery.isArray(s)&&s.length>1&&-1==s.indexOf("et al")){var c=" &amp; ";c="and"==n.and?" and ":"comma-and"==n.and?", and ":"comma-amp"==n.and?", &amp; ":"comma"==n.and?", ":" &amp; ";var h=s.join().replace(/,/g,", ");s=h.substring(0,h.lastIndexOf(", "))+c+s[s.length-1]}}else s+=l[a.key].data.title;p=l[a.key].meta.hasOwnProperty("parsedDate")?l[a.key].meta.parsedDate.substring(0,4):"n.d.",window.zpIntextCitations["post-"+a.post_id][a.key].intexttitle="title='"+JSON.stringify(s).replace("<em>et al.</em>","et al.").replace(/\"/g,"").replace("[","").replace("]","").replace(/â€™/g,"&#39;").replace(/'/g,"&#39;")+" ("+p+"). "+l[a.key].data.title+".' "}if(-1!=n.format.indexOf("%num%")){var z=n.format,g=window.zpIntextCitations["post-"+a.post_id][a.key].num;if(r=n.format.replace("%num%",g),!1!=a.pages){var m="p. ";-1!=a.pages.indexOf("-")&&(m="pp. "),r=r.replace("%p%",m+a.pages)}else r=r.replace(", %p%","");e.length>1&&(t!=e.length-1&&(r=r.replace(")","")),0!=t&&(r=""==s?r.replace("(, ",""):r.replace("(",""))),n.brackets&&(r=(r=r.replace("(","")).replace(")",""))}else{var z=n.format;r=(r=n.format.replace("%a%",s)).replace("%d%",p),r=!1==a.pages?(r=r.replace(", %p%","")).replace("%p%",""):r.replace("%p%",a.pages),"(%a%, %d%, %p%)"==z&&e.length>1&&(t!=e.length-1&&(r=r.replace(")","")),0!=t&&(r=""==s?r.replace("(, ",""):r.replace("(","")))}window.zpIntextCitations["post-"+a.post_id][a.key].hasOwnProperty("intexttitle")||(window.zpIntextCitations["post-"+a.post_id][a.key].intexttitle=""),r="<a "+window.zpIntextCitations["post-"+a.post_id][a.key].intexttitle+"class='zp-ZotpressInText' href='#zp-ID-"+a.post_id+"-"+a.api_user_id+"-"+a.key+"'>"+r+"</a>","-1"!=n.format.indexOf("sup")&&(r="<sup>"+r+"</sup>"),e[t].intext=r});var d="";n.brackets&&(d="[");var c="";n.brackets&&(c="]"),a=d,jQuery.each(e,function(t,e){0!=t&&("comma"==n.separator?a+=", ":a+="; "),a+=e.intext}),a+=c,jQuery("."+s+":eq("+p+")",r).removeClass("loading").html(a),g.hasOwnProperty(s)&&g[s]++}),function t(e,a,r,s,p){var n=!1,i=jQuery(".ZP_POSTID",e).text(),o=[],l=[],d=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];if(jQuery.each(a.data,function(t,r){var c="",h=jQuery("#"+a.instance+" .zp-List #zp-ID-"+i+"-"+r.library.id+"-"+r.key),z="0000",g="0000";r.meta.hasOwnProperty("parsedDate")&&(z=r.meta.parsedDate.substring(0,4)),r.data.hasOwnProperty("date")&&(g=r.data.date);var m=r.data.title;r.meta.hasOwnProperty("creatorSummary")&&(m=r.meta.creatorSummary.replace(/ /g,"-")),!0==s.zpTitle&&tempTitle!=z&&(c+="<h3>"+(tempTitle=z)+"</h3>\n");var y=m+"-"+g,u=g;l.push(y);var x=l.filter(t=>t===y).length;if(x>1&&(g+=d[x-1]),c+="<div id='zp-ID-"+jQuery(".ZP_POSTID",e).text()+"-"+r.library.id+"-"+r.key+"'",c+=" data-zp-author-date='"+m+"-"+g+"'",c+=" data-zp-date-author='"+g+"-"+m+"'",c+=" class='zp-Entry zpSearchResultsItem zp-Num-"+window.zpIntextCitations["post-"+i][r.key].num,2==x){var $=u+d[x-2];a.data[t-1].bib=a.data[t-1].bib.replace(u,$);var f=jQuery("#"+a.instance+" .zp-List .zp-Entry[data-zp-author-date='"+m+"-"+u+"']");f.attr("data-zp-author-date",m+"-"+$).attr("data-zp-date-author",g+d[x-2]+"-"+m),jQuery(".csl-entry",f).html(jQuery(".csl-entry",f).html().replace(u,$)),jQuery('a[href="#zp-ID-'+jQuery(".ZP_POSTID",e).text()+"-"+a.data[t-1].library.id+"-"+a.data[t-1].key+'"]').each(function(){this.text=this.text.replace(u,$)})}r.bib=r.bib.replace(u,g),jQuery('a[href="#zp-ID-'+jQuery(".ZP_POSTID",e).text()+"-"+r.library.id+"-"+r.key+'"]').each(function(){this.text=this.text.replace(u,g)}),!0===p&&(c+=" zp_updated"),jQuery("#"+a.instance+" .ZP_SHOWIMAGE").text().trim().length>0&&r.hasOwnProperty("image")?(c+=" zp-HasImage'>\n",c+="<div id='zp-Citation-"+r.key+"' class='zp-Entry-Image hasImage' rel='"+r.key+"'>\n","image"==s.zpURLWrap&&""!=r.data.url&&(c+="<a href='"+r.data.url+"'",s.zpTarget&&(c+=" target='_blank'"),c+=">"),c+="<img class='thumb' src='"+r.image[0]+"' alt='image' />\n","image"==s.zpURLWrap&&""!=r.data.url&&(c+="</a>"),c+="</div><!-- .zp-Entry-Image -->\n"):c+="'>\n";var I=function t(e,a,r){var s={order:0,item_key:""};if(/csl-left-margin/i.test(a.bib)){var p=jQuery.parseHTML(a.bib),n=jQuery(".csl-left-margin",p).text();n=n.replace(n.match(/\d+/)[0],window.zpIntextCitations["post-"+r][a.key].num),jQuery(".csl-left-margin",p).text(n),a.bib=jQuery("<div>").append(p).html(),s.order=window.zpIntextCitations["post-"+r][a.key].num,s.key=a.key}else if(jQuery("#"+e+" .ZP_FORCENUM").text().length>0&&"1"==jQuery("#"+e+" .ZP_FORCENUM").text()){var p=jQuery.parseHTML(a.bib);jQuery(".csl-entry",p).prepend('<div class="csl-left-margin" style="display: inline;">'+window.zpIntextCitations["post-"+r][a.key].num+". </div>"),a.bib=jQuery("<div>").append(p).html(),s.order=window.zpIntextCitations["post-"+r][a.key].num,s.key=a.key}return{itemNumOrder:s,item:a}}(a.instance,r,i);r=I.item,o[I.itemNumOrder.order]=I.itemNumOrder.key,/csl-left-margin/i.test(r.bib)&&(n=!0),c+=r.bib,!0==s.zpShowAbstracts&&r.data.hasOwnProperty("abstractNote")&&r.data.abstractNote.length>0&&(c+="<p class='zp-Abstract'><span class='zp-Abstract-Title'>Abstract:</span> "+r.data.abstractNote+"</p>\n"),!0==s.zpShowTags&&r.data.hasOwnProperty("tags")&&r.data.tags.length>0&&(c+="<p class='zp-Zotpress-ShowTags'><span class='title'>Tags:</span> ",jQuery.each(r.data.tags,function(t,e){c+="<span class='tag'>"+e.tag+"</span>",t!=r.data.tags.length-1&&(c+="<span class='separator'>,</span> ")}),c+="</p>\n"),c+="</div>\n",!0==s.zpShowNotes&&r.hasOwnProperty("notes")&&(tempNotes+=r.notes),h.length>0&&!0===p?h.replaceWith(jQuery(c)):0==h.length?jQuery("#"+a.instance+" .zp-List").append(c):h.replaceWith(jQuery(c))}),n&&!1===p){if(0==jQuery("#"+a.instance+" .zp-List .zp-Entry").length);else for(var c=1;c<o.length;c++){window.zpIntextCitations["post-"+i][o[c]];var h=jQuery("#zp-ID-"+i+"-"+window.zpIntextCitations["post-"+i][o[c]].api_user_id+"-"+o[c]);jQuery("#"+a.instance+" .zp-List").append(h)}}}(r,a,s.zpItemkey,s,p),!1===p&&jQuery("#"+a.instance+" .zp-SEO-Content .zp-Entry").unwrap(),!0==s.zpShowNotes&&m.length>0&&(m="<div class='zp-Citation-Notes'>\n<h4>Notes</h4>\n<ol>\n"+m,m+="</ol>\n</div><!-- .zp-Citation-Notes -->\n\n",jQuery("#"+a.instance).append(m)),!1!=a.meta.request_next&&"false"!=a.meta.request_next)t(a.meta.request_next,a.meta.request_last,r,s,p);else if(jQuery("#"+a.instance+" .zp-List").removeClass("loading"),jQuery("#"+a.instance+" .zp-List").hasClass("updating")){var y=s.zpSortBy,u=s.zpOrder;if(-1!==["author","date"].indexOf(y)&&0==jQuery("#"+a.instance+" .zp-List .csl-left-margin").length){var x="zp-author-date";"date"==y&&(x="zp-date-author"),jQuery("#"+a.instance+" .zp-List div.zp-Entry").sort(function(t,e){var a=jQuery(t).data(x).toLowerCase(),r=jQuery(e).data(x).toLowerCase();if(a>r)return"asc"==u?1:-1;return a<r?"asc"==u?-1:1:0}).detach().appendTo("#"+a.instance+" .zp-List")}}else t(0,0,r,s,!0)}else{var $=r.attr("class");jQuery("#post-"+($=$.replace("zp-Zotpress zp-Zotpress-InTextBib zp-Post-",""))).length>0?jQuery("#post-"+$+" .zp-InText-Citation").removeClass("loading").remove():jQuery("#"+r.attr("id")).parent().find(".zp-InText-Citation").removeClass("loading").remove(),jQuery("#"+r.attr("id")+" .zp-List").removeClass("loading"),jQuery("#"+r.attr("id")+" .zp-List").append("<p>There are no citations to display.</p>\n")}},error:function(t){console.log("Zotpress Error:"+t)}})}(0,0,a,r,!1)}))});