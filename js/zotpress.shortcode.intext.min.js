jQuery(document).ready((function(){if(jQuery(".zp-Zotpress-InTextBib").length>0){var e=0;window.zpIntextCitations={},window.zpIntextCitationCount={},jQuery(".zp-Zotpress-InTextBib").each((function(e,r){var i=jQuery(r),n={};if(window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",i).text()]={},n.zpItemkey=!1,jQuery(".ZP_ITEM_KEY",i).text().trim().length>0&&(n.zpItemkey=jQuery(".ZP_ITEM_KEY",i).text()),n.zpStyle=!1,jQuery(".ZP_STYLE",i).text().trim().length>0&&(n.zpStyle=jQuery(".ZP_STYLE",i).text()),n.zpTitle=!1,jQuery(".ZP_TITLE",i).text().trim().length>0&&"no"!=jQuery(".ZP_TITLE",i).text().trim()&&(n.zpTitle=jQuery(".ZP_TITLE",i).text()),n.zpShowImages=!1,jQuery(".ZP_SHOWIMAGE",i).text().trim().length>0&&(n.zpShowImages=jQuery(".ZP_SHOWIMAGE",i).text().trim()),n.zpShowTags=!1,jQuery(".ZP_SHOWTAGS",i).text().trim().length>0&&(n.zpShowTags=!0),n.zpDownloadable=!1,jQuery(".ZP_DOWNLOADABLE",i).text().trim().length>0&&(n.zpDownloadable=!0),n.zpShowNotes=!1,jQuery(".ZP_NOTES",i).text().trim().length>0&&(n.zpShowNotes=!0),n.zpShowAbstracts=!1,jQuery(".ZP_ABSTRACT",i).text().trim().length>0&&(n.zpShowAbstracts=!0),n.zpCiteable=!1,jQuery(".ZP_CITEABLE",i).text().trim().length>0&&(n.zpCiteable=!0),n.zpTarget=!1,jQuery(".ZP_TARGET",i).text().trim().length>0&&(n.zpTarget=!0),n.zpURLWrap=!1,jQuery(".ZP_URLWRAP",i).text().trim().length>0&&(n.zpURLWrap=jQuery(".ZP_URLWRAP",i).text()),n.zpHighlight=!1,jQuery(".ZP_HIGHLIGHT",i).text().trim().length>0&&(n.zpHighlight=jQuery(".ZP_HIGHLIGHT",i).text()),n.zpSortBy=!1,jQuery(".ZP_SORTBY",i).text().trim().length>0&&(n.zpSortBy=jQuery(".ZP_SORTBY",i).text()),n.zpOrder=!1,jQuery(".ZP_ORDER",i).text().trim().length>0&&(n.zpOrder=jQuery(".ZP_ORDER",i).text()),n.zpUpdateNeeded=!1,jQuery(".ZP_UPDATENEEDED",i).text().trim().length>0&&"true"==jQuery(".ZP_UPDATENEEDED",i).text()&&(n.zpUpdateNeeded=!0),n.zpJSON=!1,jQuery(".ZP_JSON",i).text().trim().length>0&&(n.zpJSON=jQuery(".ZP_JSON",i).text().trim()),jQuery(".ZP_JSON",i).text().trim().length>0){var p=JSON.parse(decodeURIComponent(n.zpJSON));a(i,n.zpItemkey,p,n,!1)}else t(0,0,i,n,!1)}))}function t(t,r,i,n,p){console.log("zp: calling zp_get_items with update check?",p),console.log("zp: is an update needed?",n.zpUpdateNeeded),void 0!==t&&"false"!=t&&""!=t||(t=0),void 0!==r&&"false"!=r&&""!=r||(r=0),jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",instance_id:i.attr("id"),type:"intext",item_key:n.zpItemkey,style:n.zpStyle,title:n.zpTitle,showimage:n.zpShowImages,showtags:n.zpShowTags,downloadable:n.zpDownloadable,shownotes:n.zpShowNotes,showabstracts:n.zpShowAbstracts,citeable:n.zpCiteable,target:n.zpTarget,urlwrap:n.zpURLWrap,highlight:n.zpHighlight,sortby:n.zpSortBy,order:n.zpOrder,update:p,request_update:n.zpUpdateNeeded,request_start:t,request_last:r,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(t){var r=jQuery.parseJSON(t);e+=r.data.length,p?console.log("zp: running update for items:",e,"->",r.data.length):console.log("zp: adding items:",e,"->",r.data.length),a(i,n.zpItemkey,r,n,p)},error:function(e){console.log("zp: Zotpress Error:"+e)}})}function a(e,a,i,n,p){if(!1===i||"error"==i.status){console.log("zp: Zotpress Error: "+i.data);var s="";jQuery("#"+i.instance+" .zp-List .zp-Entry").length>0&&(s=' class="hide"'),jQuery("#"+i.instance+" .zp-List").removeClass("loading").append("<p"+s+">Zotpress Error: "+i.data+"</p>")}else if(void 0!==i&&null!=i&&0!=parseInt(i)&&i.data.length>0){if(1==n.zpShowNotes)var o="";jQuery(e).parent();if(!1===p?jQuery("#"+i.instance+" .zp-List").addClass("used_cache"):!0===p&&(!jQuery("#"+i.instance+" .zp-List").hasClass("updating")&&jQuery("#"+i.instance+" .zp-Citation-Notes").length>0&&jQuery("#"+i.instance+" .zp-Citation-Notes").remove(),jQuery("#"+i.instance+" .zp-List").hasClass("updating")||jQuery("#"+i.instance+" .zp-List").addClass("updating")),function(e,t,a,r,i){var n=[];-1!=t.indexOf(";")?n=t.split(";"):n.push(t);var p={};jQuery.each(a,(function(e,t){p.hasOwnProperty(t.key)||(p[t.key]=t)})),a=p;var s={};jQuery.each(n,(function(t,r){var i="",n=jQuery(e).parent(),p="zp-InText-zp-ID-"+r.replace(/{/g,"-").replace(/}/g,"-").replace(/,/g,"_").replace(/:/g,"-")+"-wp"+jQuery(".ZP_POSTID",e).text(),o=0;jQuery("."+p,n).length>1&&(s.hasOwnProperty(p)?o=s[p]:s[p]=0);var l=JSON.parse(jQuery("."+p+":eq("+o+")",n).attr("rel").replace(/'/g,'"'));intext_citation_split=r.split("},{"),r=new Array,jQuery.each(intext_citation_split,(function(t,a){item_parts=a.split(":"),item_pages=!1,"np"!=l.pages&&(item_pages=l.pages.split("--"),"np"==item_pages[t]&&(item_pages[t]=!1),item_pages=item_pages[t]),r[t]={api_user_id:item_parts[0].replace("{",""),key:item_parts[1].replace("}",""),post_id:jQuery(".ZP_POSTID",e).text(),pages:item_pages,class:p}}));var d=[];jQuery.each(r,(function(e,t){var i="",n="",p="";if(window.zpIntextCitations["post-"+t.post_id].hasOwnProperty(t.key)||(window.zpIntextCitations["post-"+t.post_id][t.key]=t,void 0===window.zpIntextCitationCount["post-"+t.post_id]&&(window.zpIntextCitationCount["post-"+t.post_id]=0),window.zpIntextCitationCount["post-"+t.post_id]++,window.zpIntextCitations["post-"+t.post_id][t.key].num=window.zpIntextCitationCount["post-"+t.post_id]),a.hasOwnProperty(t.key)){if(a[t.key].data.hasOwnProperty("creators")){var s=0,o=!1;if(jQuery.each(a[t.key].data.creators,(function(e,t){if("author"==t.creatorType)return o=!0,!1})),jQuery.each(a[t.key].data.creators,(function(e,t){if(o&&"author"!=t.creatorType)return!0;s++,0!=e&&s>1&&(n+=", "),t.hasOwnProperty("name")?n+=t.name:t.hasOwnProperty("lastName")&&(n+=t.lastName)})),-1==d.indexOf(n)&&(d[d.length]=n),n=n.split(", "),jQuery.isArray(n)&&n.length>2&&(""==l.etal||"default"==l.etal||"yes"==l.etal&&(n=n[0]+" <em>et al.</em>")),jQuery.isArray(n)&&n.length>1&&-1==n.indexOf("et al")){var y=" &amp; ";y="and"==l.and?" and ":"comma-and"==l.and?", and ":"comma-amp"==l.and?", &amp; ":"comma"==l.and?", ":" &amp; ";var u=n.join().replace(/,/g,", ");n=u.substring(0,u.lastIndexOf(", "))+y+n[n.length-1]}}else n+=a[t.key].data.title;p=a[t.key].meta.hasOwnProperty("parsedDate")?a[t.key].meta.parsedDate.substring(0,4):"n.d.",window.zpIntextCitations["post-"+t.post_id][t.key].intexttitle="title='"+JSON.stringify(n).replace("<em>et al.</em>","et al.").replace(/\"/g,"").replace("[","").replace("]","").replace(/â€™/g,"&#39;").replace(/'/g,"&#39;")+" ("+p+"). "+a[t.key].data.title+".' "}if(-1!=l.format.indexOf("%num%")){var c=l.format,z=window.zpIntextCitations["post-"+t.post_id][t.key].num;if(i=l.format.replace("%num%",z),0!=t.pages){var h="p. ";-1!=t.pages.indexOf("-")&&(h="pp. "),i=i.replace("%p%",h+t.pages)}else i=i.replace(", %p%","");r.length>1&&(e!=r.length-1&&(i=i.replace(")","")),0!=e&&(i=""==n?i.replace("(, ",""):i.replace("(",""))),l.brackets&&(i=(i=i.replace("(","")).replace(")",""))}else{c=l.format;i=(i=l.format.replace("%a%",n)).replace("%d%",p),i=0==t.pages?(i=i.replace(", %p%","")).replace("%p%",""):i.replace("%p%",t.pages),("(%a%, %d%, %p%)"==c||"(%a%, %d%)"==c)&&r.length>1&&(e!=r.length-1&&(i=i.replace(")","")),0!=e&&(i=""==n?i.replace("(, ",""):i.replace("(",""))),("%a%, %d%, %p%"==c||"%a%, %d%"==c)&&r.length>1&&0!=e&&""==n&&(i=i.replace(", ",""))}window.zpIntextCitations["post-"+t.post_id][t.key].hasOwnProperty("intexttitle")||(window.zpIntextCitations["post-"+t.post_id][t.key].intexttitle=""),i="<a rel='"+t.key+"' "+window.zpIntextCitations["post-"+t.post_id][t.key].intexttitle+"class='zp-ZotpressInText' href='#zp-ID-"+t.post_id+"-"+t.api_user_id+"-"+t.key+"'>"+i+"</a>","-1"!=l.format.indexOf("sup")&&(i="<sup>"+i+"</sup>"),r[e].intext=i,r[e].class=t.class;var m="0000",g="0000";a[t.key].meta.hasOwnProperty("parsedDate")&&(m=a[t.key].meta.parsedDate,g=a[t.key].meta.parsedDate.substring(0,4));var x="";a[t.key].meta.hasOwnProperty("creatorSummary")&&(x=a[t.key].meta.creatorSummary.replace(/['" ]/g,"-")),r[e].year=g,r[e].authdate=x+"-"+m}));var y="";l.brackets&&(y="[");var u="";l.brackets&&(u="]"),i=y,jQuery.each(r,(function(e,t){0!=e&&("comma"==l.separator?i+=", ":i+="; "),i+=t.intext})),i+=u,jQuery("."+p+":eq("+o+")",n).removeClass("loading").html(i),s.hasOwnProperty(p)&&s[p]++}))}(e,n.zpItemkey,i.data),r(e,i,n.zpItemkey,n,p),!1===p&&jQuery("#"+i.instance+" .zp-SEO-Content .zp-Entry").unwrap(),1==n.zpShowNotes&&o.length>0&&(o="<div class='zp-Citation-Notes'>\n<h4>Notes</h4>\n<ol>\n"+o,o+="</ol>\n</div>\x3c!-- .zp-Citation-Notes --\x3e\n\n",jQuery("#"+i.instance).append(o)),0!=i.meta.request_next&&"false"!=i.meta.request_next)t(i.meta.request_next,i.meta.request_last,e,n,p);else if(jQuery("#"+i.instance+" .zp-List").removeClass("loading"),jQuery("#"+i.instance+" .zp-List").hasClass("updating"))if(i.updateneeded)console.log("zp: update needed"),n.zpUpdateNeeded=!0,t(0,0,e,n,!0);else{var l=n.zpSortBy,d=n.zpOrder;if(-1!==["author","date"].indexOf(l)&&0==jQuery("#"+i.instance+" .zp-List .csl-left-margin").length){var y="zp-author-date";"date"==l&&(y="zp-date-author"),jQuery("#"+i.instance+" .zp-List div.zp-Entry").sort((function(e,t){var a=jQuery(e).data(y).toLowerCase(),r=jQuery(t).data(y).toLowerCase();return a>r?"asc"==d?1:-1:a<r?"asc"==d?-1:1:0})).detach().appendTo("#"+i.instance+" .zp-List")}console.log("zp: done"),console.log("---")}else t(0,0,e,n,!0)}else{console.log("zp: no items"),console.log("---");var u=e.attr("class");u=u.replace("zp-Zotpress zp-Zotpress-InTextBib zp-Post-",""),jQuery("#post-"+u).length>0?jQuery("#post-"+u+" .zp-InText-Citation").removeClass("loading").remove():jQuery("#"+e.attr("id")).parent().find(".zp-InText-Citation").removeClass("loading").remove(),jQuery("#"+e.attr("id")+" .zp-List").removeClass("loading"),jQuery("#"+e.attr("id")+" .zp-List").append("<p>There are no citations to display.</p>\n")}}function r(e,t,a,r,i){var n=!1,p=jQuery(".ZP_POSTID",e).text(),s=[],o=[],l={},d=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];if(jQuery.each(t.data,(function(a,y){var u="",c=jQuery("#"+t.instance+" .zp-List #zp-ID-"+p+"-"+y.library.id+"-"+y.key),z="0000",h="0000";y.meta.hasOwnProperty("parsedDate")&&(z=y.meta.parsedDate,h=y.meta.parsedDate.substring(0,4));var m="";y.meta.hasOwnProperty("creatorSummary")&&(m=y.meta.creatorSummary.replace(/['" ]/g,"-"));r.zpTitle&&(y.data.title.substr(10).replace(/['" ]/g,"-"),u+="<h3>"+h+"</h3>\n");var g=m+"-"+z,x="",j=1,w=!1;if(o.includes(g)&&(w=!0,j=o.filter((e=>e===g)).length,x=d[j-1],j+=1),o.push(g),l[g+"-"+(j-1)]={itemkey:y.key,authDateStrDisAlpha:x},u+="<div id='zp-ID-"+jQuery(".ZP_POSTID",e).text()+"-"+y.library.id+"-"+y.key+"'",u+=" data-zp-author-date='"+m+"-"+z+"'",u+=" data-zp-date-author='"+z+"-"+m+"'",u+=" class='zp-Entry zpSearchResultsItem zp-Num-"+window.zpIntextCitations["post-"+p][y.key].num,w){if(2==j){var Q=l[g+"-0"].itemkey,_=window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][Q].year+"b";window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][Q].intexttitle=window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][Q].intexttitle.replaceAll(h,_),window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][Q].intext=window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][Q].intext.replaceAll(h,_),jQuery.each(t.data,(function(e,a){a.key==Q&&-1==t.data[e].bib.indexOf(_)&&(t.data[e].bib=t.data[e].bib.replace(h,_))})),jQuery("."+window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][Q].class).each((function(){jQuery('a[rel="'+Q+'"',this).text(jQuery('a[rel="'+Q+'"',this).text().replaceAll(h,_)),jQuery('a[rel="'+Q+'"',this).attr("title",jQuery('a[rel="'+Q+'"',this).attr("title").replaceAll(h,_))}));var I=jQuery("#zp-ID-"+p+"-"+y.library.id+"-"+Q);-1==(P=jQuery("#zp-ID-"+p+"-"+y.library.id+"-"+Q+" .csl-entry")).html().indexOf(_)&&P.html(P.html().replace(h,_)),I.addClass("zp_disam").attr("data-zp-author-date",m+"-"+_).attr("data-zp-date-author",_+"-"+m)}_=h+x;window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][y.key].intexttitle=window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][y.key].intexttitle.replaceAll(h,_),window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][y.key].intext=window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][y.key].intext.replaceAll(h,_),-1==y.bib.indexOf(_)&&(y.bib=y.bib.replace(h,_)),-1==t.data[a].bib.indexOf(_)&&(t.data[a].bib=t.data[a].bib.replace(h,_)),jQuery("."+window.zpIntextCitations["post-"+jQuery(".ZP_POSTID",e).text()][y.key].class).each((function(){jQuery('a[rel="'+y.key+'"',this).text(jQuery('a[rel="'+y.key+'"',this).text().replaceAll(h,_)),jQuery('a[rel="'+y.key+'"',this).attr("title",jQuery('a[rel="'+y.key+'"',this).attr("title").replaceAll(h,_))}));var P;I=jQuery("#zp-ID-"+p+"-"+y.library.id+"-"+y.key);(P=jQuery("#zp-ID-"+p+"-"+y.library.id+"-"+y.key+" .csl-entry")).html()&&-1==P.html().indexOf(_)&&P.html(P.html().replace(h,_)),I.addClass("zp_disam").attr("data-zp-author-date",m+"-"+_).attr("data-zp-date-author",_+"-"+m)}!0===i&&(u+=" zp_updated"),jQuery("#"+t.instance+" .ZP_SHOWIMAGE").text().trim().length>0&&y.hasOwnProperty("image")?(u+=" zp-HasImage'>\n",u+="<div id='zp-Citation-"+y.key+"' class='zp-Entry-Image hasImage' rel='"+y.key+"'>\n","image"==r.zpURLWrap&&""!=y.data.url&&(u+="<a href='"+y.data.url+"'",r.zpTarget&&(u+=" target='_blank'"),u+=">"),u+="<img class='thumb' src='"+y.image[0]+"' alt='image' />\n","image"==r.zpURLWrap&&""!=y.data.url&&(u+="</a>"),u+="</div>\x3c!-- .zp-Entry-Image --\x3e\n"):u+="'>\n";var f=function(e,t,a){var r={order:0,item_key:""};if(/csl-left-margin/i.test(t.bib)){var i=jQuery.parseHTML(t.bib),n=jQuery(".csl-left-margin",i).text();n=n.replace(n.match(/\d+/)[0],window.zpIntextCitations["post-"+a][t.key].num),jQuery(".csl-left-margin",i).text(n),t.bib=jQuery("<div>").append(i).html(),r.order=window.zpIntextCitations["post-"+a][t.key].num,r.key=t.key}else if(jQuery("#"+e+" .ZP_FORCENUM").text().length>0&&"1"==jQuery("#"+e+" .ZP_FORCENUM").text()){i=jQuery.parseHTML(t.bib);jQuery(".csl-entry",i).prepend('<div class="csl-left-margin" style="display: inline;">'+window.zpIntextCitations["post-"+a][t.key].num+". </div>"),t.bib=jQuery("<div>").append(i).html(),r.order=window.zpIntextCitations["post-"+a][t.key].num,r.key=t.key}return{itemNumOrder:r,item:t}}(t.instance,y,p);y=f.item,s[f.itemNumOrder.order]=f.itemNumOrder.key,/csl-left-margin/i.test(y.bib)&&(n=!0),u+=y.bib,1==r.zpShowAbstracts&&y.data.hasOwnProperty("abstractNote")&&y.data.abstractNote.length>0&&(u+="<p class='zp-Abstract'><span class='zp-Abstract-Title'>Abstract:</span> "+y.data.abstractNote+"</p>\n"),1==r.zpShowTags&&y.data.hasOwnProperty("tags")&&y.data.tags.length>0&&(u+="<p class='zp-Zotpress-ShowTags'><span class='title'>Tags:</span> ",jQuery.each(y.data.tags,(function(e,t){u+="<span class='tag'>"+t.tag+"</span>",e!=y.data.tags.length-1&&(u+="<span class='separator'>,</span> ")})),u+="</p>\n"),u+="</div>\n",1==r.zpShowNotes&&y.hasOwnProperty("notes")&&(tempNotes+=y.notes),c.length>0&&!0===i?c.replaceWith(jQuery(u)):0==c.length?jQuery("#"+t.instance+" .zp-List").append(u):c.replaceWith(jQuery(u))})),n&&!1===i)if(0==jQuery("#"+t.instance+" .zp-List .zp-Entry").length);else for(var y=1;y<s.length;y++){window.zpIntextCitations["post-"+p][s[y]];var u=jQuery("#zp-ID-"+p+"-"+window.zpIntextCitations["post-"+p][s[y]].api_user_id+"-"+s[y]);jQuery("#"+t.instance+" .zp-List").append(u)}}}));